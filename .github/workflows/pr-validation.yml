name: PR Build Validation
on:
  pull_request
jobs:
  Build-Java:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR
        uses: actions/checkout@v3
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: corretto
          java-version: '21'
          cache: maven
      - name: Maven Compile, Test, Install
        run: mvn install -Dcheckstyle.skip -Dspotbugs.skip
      - name: Spotbugs Check
        run: mvn spotbugs:check
      - name: Code Style Check
        run: mvn checkstyle:check
  Build-WebClient:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: 16
      - name: Cache node modules
        uses: actions/cache@v2
        env:
          cache-name: cache-node-modules
        with:
          # npm cache files are stored in `~/.npm` on Linux/macOS
          path: ~/.npm
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}-
            ${{ runner.os }}-build-
            ${{ runner.os }}-
      # CI=false is required because GitHub hosted runners set CI=true, which causes Warnings to be treated as Errors when doing yarn build
      # this is a workaround to allow the build to succeed until we can get around to fixing the warnings generated
      # https://docs.github.com/en/actions/reference/environment-variables#default-environment-variables
      # TODO remove CI=false
      - name: Build WebClient
        run: |
          cd ${{ github.workspace }}/client/web
          yarn
          CI=false yarn build